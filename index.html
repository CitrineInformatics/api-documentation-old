<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Citrination API Reference</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["shell","python"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="shell">shell</a>
              <a href="#" data-language-name="python">python</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='http://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>This document includes necessary information for working with the citrination API using either a shell (via curl) or python script. For every example, you can switch between languages using the tabs to the right.</p>

<p>The API currently includes the ability to search against data already on citrination. Additional features will be added in the future and included in this document.</p>

<h1 id="using-the-api">Using the API</h1>

<h2 id="accessing-your-site">Accessing Your Site</h2>

<p>The API can be accessed at https://citrination.com/api or at any sub-domain, e.g. https://your-site.citrination.com/api (where &ldquo;your-site&rdquo; is the specific site that you want to access).</p>

<h2 id="api-token">API Token</h2>

<p>Each citrination user is assigned a unique access key. You can access your API key by logging into your-site.citrination.com and clicking on &ldquo;Account&rdquo; at the top of the page.</p>

<p>Note that your API Token is valid only on the site that you accessed it from. In other words, a token for accessing the API at your-site.citrination.com is not valid for another-site.citrination.com.</p>

<h2 id="connecting-to-the-api">Connecting to the API</h2>
<pre class="highlight python"><code><span class="c"># Your API key is used in the constructor for CitrinationClient objects</span>
<span class="kn">from</span> <span class="nn">citrination_client</span> <span class="kn">import</span> <span class="n">CitrinationClient</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">CitrinationClient</span><span class="p">(</span><span class="s">'your-unique-api-key'</span><span class="p">,</span> <span class="s">'https://your-site.citrination.com'</span><span class="p">)</span>
</code></pre>
<pre class="highlight shell"><code><span class="c"># Authentication tokens must be applied to the headers of any requests made to the Citrination API</span>
curl https://your-site.citrination.com
  -H <span class="s1">'X-API-Key: your-unique-api-key'</span>
</code></pre>

<p>The API can be accessed using HTTP requests or a python client. An implementation of the python client can be downloaded from <a href="https://github.com/CitrineInformatics/python-citrination-client/tree/legacy">https://github.com/CitrineInformatics/python-citrination-client/tree/legacy</a>. Python examples in this document use this client.</p>

<h2 id="search-api">Search API</h2>

<h3 id="a-name-search_all-a"><a name="search_all">Search All Data Sets</a></h3>
<pre class="highlight python"><code><span class="c"># Retrieve the power factor of CrFeSn</span>
<span class="kn">from</span> <span class="nn">citrination_client</span> <span class="kn">import</span> <span class="n">CitrinationClient</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">CitrinationClient</span><span class="p">(</span><span class="s">'your-unique-api-key'</span><span class="p">,</span> <span class="s">'https://your-site.citrination.com'</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s">'CrFeSn'</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="s">'power factor'</span><span class="p">)</span>
<span class="c"># Use r.json() to convert the content of the response from JSON</span>
</code></pre>
<pre class="highlight shell"><code><span class="c"># Retrieve the power factor of CrFeSn</span>
curl https://your-site.citrination.com/api/mifs/search
  -H <span class="s1">'X-API-Key: your-api-key'</span>
  -d <span class="s1">'formula=CrFeSn&amp;property=power+factor'</span>
</code></pre>

<p>The general search API is accessed at https://your-site.citrination.com/api/mifs/search. This will search across all data sets stored at your-site.citrination.com. The following parameters are supported:</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>term</td>
<td>The basic search query. Terms entered here are searched for in all fields.</td>
</tr>
<tr>
<td>formula</td>
<td>Limit the search results by chemical formula.</td>
</tr>
<tr>
<td>property</td>
<td>Limit the search results by property name.</td>
</tr>
<tr>
<td>contributor</td>
<td>Limit the search results by the name of the person that contributed the data.</td>
</tr>
<tr>
<td>reference</td>
<td>Limit the search results by the original reference for the data.</td>
</tr>
<tr>
<td>min_measurement</td>
<td>Minimum value for property value.</td>
</tr>
<tr>
<td>max_measurement</td>
<td>Maximum value for property value.</td>
</tr>
<tr>
<td>from_record</td>
<td>If using pagination, set the index of starting record. Defaults to 0.</td>
</tr>
<tr>
<td>per_page</td>
<td>If using pagination, sets the number of records that are returned. Defaults to 10. The maximum value is 100 (see <a href="#pagination">pagination</a>).</td>
</tr>
</tbody></table>

<p>* When searching over <em>all</em> data sets, at least one parameter other than <em>from_record</em> or <em>per_page</em> must be set.</p>

<h3 id="a-name-search_single-a"><a name=search_single>Search a Single Data set</a></h3>
<pre class="highlight python"><code><span class="c"># Retrieve the power factor of CrFeSn in data set 12</span>
<span class="kn">from</span> <span class="nn">citrination_client</span> <span class="kn">import</span> <span class="n">CitrinationClient</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">CitrinationClient</span><span class="p">(</span><span class="s">'your-unique-api-key'</span><span class="p">,</span> <span class="s">'https://your-site.citrination.com'</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s">'CrFeSn'</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="s">'power factor'</span><span class="p">,</span> <span class="n">data_set_id</span><span class="o">=</span><span class="s">'12'</span><span class="p">)</span>
<span class="c"># Use r.json() to convert the content of the response from JSON</span>
</code></pre>
<pre class="highlight shell"><code><span class="c"># Retrieve the power factor of CrFeSn in data set 12</span>
curl https://your-site.citrination.com/api/data_sets/12/mifs/search
  -H <span class="s1">'X-API-Key: your-api-key'</span>
  -d <span class="s1">'formula=CrFeSn&amp;property=power+factor'</span>
</code></pre>

<p>The data-set-specific search API is accessed at https://your-site.citrination.com/api/data_sets/<em>ID</em>/mifs/search. This will search against the single data set with id equal to <em>ID</em> at your-site.citrination.com. This API supports the same set of parameters as <a href="#search_all">searching all data sets</a>.</p>

<h3 id="search-results">Search Results</h3>

<blockquote>
<p>Example response from the search API</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"hits"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"results"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nt">"sample"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"data_set_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
                </span><span class="nt">"material"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"chemicalFormula"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CrFeSn"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nt">"measurement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"dataType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Experimental"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"property"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"units"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mW/K$^2 \\cdot$m"</span><span class="p">,</span><span class="w">
                            </span><span class="nt">"scalar"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                </span><span class="p">{</span><span class="w">
                                    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="w">
                                </span><span class="p">}</span><span class="w">
                            </span><span class="p">],</span><span class="w">
                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Power factor"</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="nt">"reference"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                            </span><span class="p">{</span><span class="w">
                                </span><span class="nt">"citation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10.1143/JPSJ.79.124702"</span><span class="w">
                            </span><span class="p">}</span><span class="w">
                        </span><span class="p">]</span><span class="w">
                    </span><span class="p">},</span><span class="w">
                    </span><span class="p">{</span><span class="w">
                        </span><span class="nt">"dataType"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Experimental"</span><span class="p">,</span><span class="w">
                        </span><span class="nt">"property"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                            </span><span class="nt">"scalar"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                                </span><span class="p">{</span><span class="w">
                                    </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0"</span><span class="w">
                                </span><span class="p">}</span><span class="w">
                            </span><span class="p">],</span><span class="w">
                            </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Thermoelectric figure of merit (zT)"</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="nt">"reference"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                            </span><span class="p">{</span><span class="w">
                                </span><span class="nt">"citation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10.1143/JPSJ.79.124702"</span><span class="w">
                            </span><span class="p">}</span><span class="w">
                        </span><span class="p">]</span><span class="w">
                    </span><span class="p">}</span><span class="w">
                </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nt">"time"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Results from a search across <a href="#search_all">all data sets</a> or a <a href="#search_single">single data set</a> return the same response, an example of which is shown to the right.</p>

<p>The top level object of a search result contains three fields: hits, which gives the number of results that were found; time, which is the number of milliseconds that the search endpoint took to run the query; results, which contains the records that matched the search query. The value of the results field is structured according to the <a href="http://www.citrine.io/mif">MIF Schema</a>.</p>

<h4 id="python-response">Python Response</h4>

<p>The return object of CitrinationClient.search() is a <a href="http://www.python-requests.org/en/latest/api/#requests.Response">response object</a> from the <a href="http://www.python-requests.org">requests package</a>. In the search examples, r.status_code gives the status code from the API response and r.json() decodes the content of the response from JSON.</p>

<h3 id="a-name-pagination-a"><a name="pagination">Pagination</a></h3>
<pre class="highlight python"><code><span class="c"># Page through all records in data set with id '1'</span>
<span class="kn">from</span> <span class="nn">citrination_client</span> <span class="kn">import</span> <span class="n">CitrinationClient</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">CitrinationClient</span><span class="p">(</span><span class="s">'your-unique-api-key'</span><span class="p">,</span> <span class="s">'https://your-site.citrination.com'</span><span class="p">)</span>
<span class="n">size</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
  <span class="n">r</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">data_set_id</span><span class="o">=</span><span class="s">'1'</span><span class="p">,</span> <span class="n">from_record</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">per_page</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
  <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s">'results'</span><span class="p">])</span>
  <span class="n">start</span> <span class="o">+=</span> <span class="n">size</span>
  <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="c"># Remember to sleep to avoid rate limiting!</span>
</code></pre>
<pre class="highlight shell"><code></code></pre>

<p>If you need to access more results than the number specified by <em>per_page</em>, then you can iterate through them by setting the <em>from_record</em> parameter. The python example to the right shows the code to iterate through all records in a data set with id &lsquo;1&rsquo;.</p>

<p>There is a hard limit of 100 results returned per request. Any value of <em>per_page</em> larger than that will be reduced to 100.</p>

<h3 id="rate-limiting">Rate Limiting</h3>

<p>Access to the search API is rate-limited. Currently users must wait 3 seconds between search requests via the API. The API will return a 403 response code when the rate limit is exceeded (note that the timer is reset each time that a request is made, regardless of whether results were returned or not).</p>

<!--
## Upload Data
```python
from citrination_client import CitrinationClient
client = CitrinationClient('your-unique-api-key', 'https://your-site.citrination.com')
client.upload(name='My Published Paper', description='Band Gaps of My Favorite Compounds', filename='mypaper.pdf')
```

You can upload data using the python client, but not directly through HTTP at this time.
Uploading data will start it off in our data processing pipeline, and in a few minutes time
it will be available on the web via https://your-site.citrination.com/data_uploads
-->

<h1 id="useful-links">Useful Links</h1>

<ul>
<li><a href="http://www.citrine.io/api">http://www.citrine.io/api</a> This document.</li>
<li><a href="http://www.citrine.io/mif">http://www.citrine.io/mif</a> Definition of the MIF schema (structure of the results of the search API).</li>
<li><a href="https://github.com/CitrineInformatics/python-citrination-client/tree/legacy">https://github.com/CitrineInformatics/python-citrination-client/tree/legacy</a> Python client for accessing the citrination API.</li>
</ul>

          <h1 id="errors">Errors</h1>

<p>The Citrination API uses the following error codes:</p>

<table><thead>
<tr>
<th>Error Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request &ndash; Your request is malformed</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized &ndash; Your API key is wrong</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden &ndash; Rate limit exceded</td>
</tr>
<tr>
<td>404</td>
<td>Not Found &ndash; The specified method or document could not be found</td>
</tr>
<tr>
<td>406</td>
<td>Not Acceptable &ndash; You requested a format that isn&rsquo;t json</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests &ndash; You&rsquo;re making too many requests per second. Please wait</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error &ndash; We had a problem with our server. Try again later.</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable &ndash; We&rsquo;re temporarially offline for maintanance. Please try again later.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">shell</a>
                <a href="#" data-language-name="python">python</a>
          </div>
      </div>
    </div>
  </body>
</html>
